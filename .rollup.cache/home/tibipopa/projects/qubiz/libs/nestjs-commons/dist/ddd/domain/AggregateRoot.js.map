{"version":3,"file":"AggregateRoot.js","sourceRoot":"","sources":["../../../src/ddd/domain/AggregateRoot.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,IAAI,iBAAiB,EAAE,MAAM,cAAc,CAAC;AAClE,OAAO,KAAK,CAAC,MAAM,QAAQ,CAAC;AAgB5B,MAAM,OAAgB,aAGpB,SAAQ,iBAA8B;IACtC,YAA8B,MAAS;QACrC,KAAK,EAAE,CAAC;QADoB,WAAM,GAAN,MAAM,CAAG;QAGrC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC1B,CAAC;IAEM,MAAM,CAAC,SAAS,CAErB,KAAQ;QAER,OAAO,IAAI,IAAI,CAAC,CAAC,CAAC,SAAS,CAAI,KAAK,CAAC,CAAC,CAAC;IACzC,CAAC;IAED,IAAW,EAAE;QACX,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;IACxB,CAAC;IAED,IAAW,KAAK;QACd,OAAO,CAAC,CAAC,SAAS,CAAI,IAAI,CAAC,MAAM,CAAC,CAAC;IACrC,CAAC;CACF","sourcesContent":["import { AggregateRoot as NestAggregateRoot } from '@nestjs/cqrs';\nimport * as _ from 'lodash';\n\nimport { DomainEvent } from './DomainEvent';\n\nexport type AggregateRootState<T = any> = {\n  id: T;\n};\n\nexport type AggregateRootConstructor<\n  I,\n  S extends AggregateRootState<I>,\n  T extends AggregateRoot<I, S>,\n> = {\n  new (state: S): T;\n};\n\nexport abstract class AggregateRoot<\n  I = any,\n  S extends AggregateRootState<I> = AggregateRootState,\n> extends NestAggregateRoot<DomainEvent> {\n  private constructor(protected _state: S) {\n    super();\n\n    this.autoCommit = false;\n  }\n\n  public static fromState<I, S extends AggregateRootState<I>, T extends AggregateRoot<I, S>>(\n    this: AggregateRootConstructor<I, S, T>,\n    state: S,\n  ): T {\n    return new this(_.cloneDeep<S>(state));\n  }\n\n  public get id(): I {\n    return this._state.id;\n  }\n\n  public get state(): S {\n    return _.cloneDeep<S>(this._state);\n  }\n}\n"]}